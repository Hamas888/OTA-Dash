<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wireless Debug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <div class="container">
    <h1>%PORTAL_HEADING% Debug Logs</h1>

    <div class="log-screen" id="logs">
      <span style="color: #888888;">Debug Console Ready - Waiting for messages...</span>
    </div>

    <div style="margin-top: 10px;">
      <button onclick="clearLogs()" class="button" style="margin-right: 10px;">Clear Logs</button>
      <a href="/" class="button">Back</a>
    </div>
  </div>

  <script>
    let ws;
    const reconnectInterval = 5000;

    function connectWebSocket() {
      try {
        ws = new WebSocket(`ws://${window.location.hostname}/ws`);

        ws.onopen = () => {
          console.log("WebSocket connected");
          appendLog("WebSocket Connected", "#00ff00");
        };

        ws.onmessage = (event) => {
          const logsDiv = document.getElementById("logs");
          logsDiv.innerHTML += event.data + "<br/>";
          logsDiv.scrollTop = logsDiv.scrollHeight;
        };

        ws.onclose = () => {
          console.log("WebSocket disconnected");
          appendLog("WebSocket Disconnected - Reconnecting...", "#ff0000");
          setTimeout(connectWebSocket, reconnectInterval);
        };

        ws.onerror = (error) => {
          console.error("WebSocket error:", error);
          appendLog("WebSocket Error", "#ff0000");
        };
      } catch (e) {
        console.error("Failed to create WebSocket:", e);
        appendLog("Failed to connect WebSocket", "#ff0000");
        setTimeout(connectWebSocket, reconnectInterval);
      }
    }

    function appendLog(message, color) {
      const logsDiv = document.getElementById("logs");
      logsDiv.innerHTML += `<div style="color: ${color};">${message}</div>`;
    }

    function clearLogs() {
      document.getElementById("logs").innerHTML =
        '<div style="color: #888888;">Debug Console Cleared</div>';
    }

    connectWebSocket();
  </script>
</body>
</html>